<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>角色生成</title>
    <link rel="stylesheet" href="css/create_char.css">
</head>
<body>
    <!-- 导航栏 -->
    <header class="navbar">
        <button id="back-to-main-btn" class="back-button">
            <img src="images/btn_arrow-right.png" alt="返回" class="back-icon">
            返回工作台
        </button>
        <p class="center-text">角色生成</p>
        <nav class="nav-menu">
        </nav>
    </header>

    <!-- 主内容区域 -->
    <div class="container">
        <!-- 左侧功能区 -->
        <div class="left-section">
            <div class="form-section">
                <label>素材描述</label>
                <textarea id="material-description" placeholder="请输入描述，例如：一个慈祥的穿着西装的牛顿，卷发"></textarea>
                <label>选择基础风格</label>
                <div class="select-models">
                    <select id="base-style">
                        <option value="3d-cartoon">3D卡通</option>
                        <option value="realistic">写实风格</option>
                        <option value="anime">动漫风格</option>
                    </select>
                    <select id="tweak-model">
                        <option value="default">微调模型 (可选)</option>
                        <option value="model1">模型1</option>
                        <option value="model2">模型2</option>
                    </select>
                </div>
                <label>图片尺寸</label>
                <div class="select-size-container">
                    <div class="set-width">
                        <span class="input-label">W</span>
                        <input type="number" id="width" placeholder="宽度" value="512"> 
                    </div>
                    <div class="set-height">
                        <span class="input-label">H</span>
                        <input type="number" id="height" placeholder="高度" value="512"> 
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="transparent-background" checked>
                        <label for="transparent-background">透明背景</label>
                    </div>
                </div>
                <div class="checkbox-container">
                    <div class="checkbox-group">
                        <input type="checkbox" id="import-refimg" checked>
                        <label for="import-refimg">开启参考</label>
                    </div>
                </div>

                <div id="advanced-content">
                    <div class="upload-and-preview-container">
                        <div class="file-upload-container">
                            <label>导入参考图</label>
                            <input type="file" id="file-input" accept="image/*" style="display: none;">
                            <button class="file-upload">
                                <img src="images/btn_add.png" alt="添加" id="add-btn">
                                <label for="file-input" class="upload-label">点击上传</label>
                            </button>
                            <img id="preview-upload-image" src="#" alt="Image Preview" style="display:none; max-width: 280px; margin-top: 10px;">
                        </div>
                        <div class="preview-container">
                            <label>预处理预览</label>
                            <div class="preview-image">
                                <img id="preview-image" alt="预览图像" style="display: none;" />
                                <p id="no-preview" style="color: gray;">暂无预览图像</p>
                            </div>
                        </div>
                    </div>
                    <label>选择参考维度</label>
                    <div class="reference-dimensions">
                        <button class="dimension-btn" data-dimension="edge-outline">边缘轮廓</button>
                        <button class="dimension-btn" data-dimension="character">景深</button>
                        <button class="dimension-btn" data-dimension="pose">人物姿势</button>
                        <button class="dimension-btn" data-dimension="style">风格</button>
                        <button class="dimension-btn" data-dimension="character">角色特征</button>
                    </div>
                    <label>参考权重</label>
                    <span id="weight-value">0.3</span>
                    <div class="slider-container-all">
                        <span>0</span>
                        <div class="slider-container">
                            <div class="slider-track"></div>
                            <input type="range" id="weight-slider" min="0" max="1" step="0.1" value="0.3" />
                        </div>
                        <span>1</span>
                    </div>
                </div>
                <button id="generate-btn" class="primary-btn">生成</button>
            </div>
        </div>

        <!-- 右侧预览区 -->
        <div class="right-section">
            <label>效果图预览</label>
            <div class="preview-grid">
                <div class="preview-image">
                    <img src="images/gen-image.png" alt="效果图" class="preview-image-img">
                </div>
                <div class="preview-image">
                    <img src="images/gen-image.png" alt="效果图" class="preview-image-img">
                </div>
                <div class="preview-image">
                    <img src="images/gen-image.png" alt="效果图" class="preview-image-img">
                </div>
                <div class="preview-image">
                    <img src="images/gen-image.png" alt="效果图" class="preview-image-img">
                </div>
            </div>
            <button id="apply-and-return-btn" class="secondary-btn">应用并返回</button>
        </div>
    </div>

    <!-- 脚本 -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 开启参考
            const importRefImgCheckbox = document.getElementById('import-refimg');
            const advancedContent = document.getElementById('advanced-content');
            importRefImgCheckbox.checked = false;
            advancedContent.style.display = 'none';
            importRefImgCheckbox.addEventListener('change', function() {
                if (importRefImgCheckbox.checked) {
                    advancedContent.style.display = 'block';
                    updateSliderTrack(); 
                } else {
                    advancedContent.style.display = 'none';
                }
            });
            
            // 上传参考图
            document.querySelector('.file-upload').addEventListener('click', function() {
                document.getElementById('file-input').click();

            });
            document.getElementById('file-input').addEventListener('change', function() {
                if (this.files.length > 0) {
                    // 处理文件选择后的逻辑
                    console.log('文件已选择:', this.files[0].name);

                    // 显示预览图像
                    const previewImage = document.getElementById('preview-upload-image');
                    previewImage.src = URL.createObjectURL(this.files[0]);
                    previewImage.style.display = 'block';
                    document.querySelector('.file-upload').style.display = 'none';
                }
            });

            // 权重进度条
            const slider = document.getElementById('weight-slider');
            const weightValue = document.getElementById('weight-value');
            const sliderTrack = document.querySelector('.slider-track');
            function updateSliderTrack() {
                const value = slider.value;
                const width = (value * 100) + '%';
                sliderTrack.style.width = width;
                weightValue.textContent = slider.value;
                // 计算 weight-value 的位置
                const sliderRect = slider.getBoundingClientRect();
                const sliderWidth = sliderRect.width;
                const valuePosition = (value / slider.max) * sliderWidth;
                weightValue.style.left = (valuePosition+180) + 'px';
            }
            slider.addEventListener('input', updateSliderTrack);
            updateSliderTrack(); 
            //选择维度
            const dimensionButtons = document.querySelectorAll('.dimension-btn');
            dimensionButtons.forEach(button => {
                button.addEventListener('click', function() {
                    dimensionButtons.forEach(btn => {
                        btn.classList.remove('active');
                    });
                    this.classList.add('active');
                });
            });
            //选择图片
            const previewImages = document.querySelectorAll('.preview-image-img');
            previewImages.forEach(image => {
                image.addEventListener('click', function() {
                    // 移除其他图片的选中状态
                    previewImages.forEach(img => img.classList.remove('selected'));

                    // 为当前点击的图片添加选中状态
                    this.classList.add('selected');
                });
            });
            // 应用并返回按钮逻辑
            const backToMainBtn = document.getElementById('back-to-main-btn');
            backToMainBtn.addEventListener('click', function() {
                window.location.href = 'mainboard.html';
            });
        });
    </script>
</body>
</html>